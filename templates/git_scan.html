<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OSS Scan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-light">
        <div class="container-fluid">
            <a class="navbar-brand text-primary" href="/"><b>OSS Scan</b></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" href="/git-scan"><b>Git-Scan</b></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/py-scan"><b>Python Package</b></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><b>Custom-Scan</b></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Main Body -->
    <section>
        <div class="container-fluid">
            <div class="row">
                <div class="col-5 p-5 bg-dark">
                    <div class="card text-left">
                        <div class="card-body">
                            <h5 class="card-title">Scan Github Repo</h5>
                            <form method="POST" action="/git-scan-link" id="urlForm">
                                <div class="mb-3">
                                    <label for="repolink" class="form-label">GitHub Repo Link</label>
                                    <input type="text" class="form-control" id="repolink" name="repolink" aria-describedby="emailHelp" , placeholder="https://github.com/username/reponame" value="https://github.com/Rajsoni03/HousieTicket">
                                    <!-- <div id="emailHelp" class="form-text">We'll never share your repo with anyone else.</div> -->
                                </div>
                            </form>
                            <button id='myBtn' class="btn btn-primary">Security Scan</button>
                            <div class="loading" id="loading"> </div>
                        </div>
                    </div>
                </div>
                <div class="col-7 p-5 pt-2 bg-warning">
                    <content id="report">
                        <h2 class="text-center">Report</h2>
                        <div class="accordion" id="accordionPanelsStayOpenExample">
                            <!-- start -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="panel1">
                                    <button class="accordion-button myshadow" type="button" data-bs-toggle="collapse" data-bs-target="#panelcol1" aria-expanded="true" aria-controls="panelcol1">
                                        <div class="row">
                                            <div class="col-8 mx-0">
                                                <span class="placeholder col-6 placeholder-lg"></span><br>
                                                <span class="placeholder col-9"></span>
                                            </div>
                                            <div class="col-4 mx-0 text-right">
                                                <span class="placeholder col-4 m-1"></span><br>
                                                <span class="placeholder col-6  m-1"></span>
                                            </div>
                                        </div>
                                    </button>
                                </h2>
                                <div id="panelcol1" class="accordion-collapse collapse show bg-light" aria-labelledby="panel1">
                                    <div class="accordion-body">
                                        <p class="card-text placeholder-glow">
                                            <span class="placeholder placeholder-sm col-7"></span>
                                            <span class="placeholder placeholder-sm col-4"></span>
                                            <span class="placeholder placeholder-sm col-4"></span>
                                            <span class="placeholder placeholder-sm col-6"></span>
                                            <span class="placeholder placeholder-sm col-8"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="panel2">
                                    <button class="accordion-button collapsed myshadow" type="button" data-bs-toggle="collapse" data-bs-target="#panelcol2" aria-expanded="false" aria-controls="panelcol2">
                                        <div class="row">
                                            <div class="col-8 mx-0">
                                                <span class="placeholder col-6 placeholder-lg"></span><br>
                                                <span class="placeholder col-9"></span>
                                            </div>
                                            <div class="col-4 mx-0 text-right">
                                                <span class="placeholder col-4 m-1"></span><br>
                                                <span class="placeholder col-6  m-1"></span>
                                            </div>
                                        </div>
                                    </button>
                                </h2>
                                <div id="panelcol2" class="accordion-collapse collapse" aria-labelledby="panel2">
                                    <div class="accordion-body">
                                        <p class="card-text placeholder-glow">
                                            <span class="placeholder placeholder-sm col-7"></span>
                                            <span class="placeholder placeholder-sm col-4"></span>
                                            <span class="placeholder placeholder-sm col-4"></span>
                                            <span class="placeholder placeholder-sm col-6"></span>
                                            <span class="placeholder placeholder-sm col-8"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <!-- end -->
                        </div>
                    </content>
                </div>
            </div>
        </div>
    </section>
    <style type="text/css">
    .loading {
        background: url(../static/loading.svg) no-repeat 50% 50%;
        width: auto;
        height: 40px;
    }

    .accordion-button {
        display: block;
    }

    .accordion-button .col-4 {
        text-align: right;
    }

    .myshadow {
        border: 1px solid;
        padding: 10px;
        box-shadow: 5px 10px 8px #888888;
    }

    .myshadow active {
        border: 1px solid;
        padding: 10px;
        box-shadow: 5px 10px 8px #888888;
    }
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    <script type="text/javascript">
    // ajax send image to api
    $('#loading').hide();
    $('#report').hide();

    $(function() {
        $('#myBtn').click(function() {
            setTimeout(function() {
                $('#loading').show();
                $('#report').show();
            }, 100);
            var form_data = new FormData($('#urlForm')[0]);
            $.ajax({
                type: 'POST',
                url: '/git-scan-link',
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                complete: function() {
                    setTimeout(function() {
                        $('#loading').hide();
                    }, 0);
                },
                success: function(data) {
                    console.log(data);
                    if (data['status'] == true) {
                        updateReport(data);
                    }
                },
            });
        });
    });

    function updateReport(data) {
        var data = data;
        $('#report').show();
        var length = data['report'].length;
        var str = "";

        for (var i = 0; i < length; i++) {
            var panel = i + 1;
            var issue = data['report'].issueList[i];
            var colors = { 'Undefined': 'light', 'Low': 'success', 'Medium': 'warning', 'High': 'danger' };

            var headding = '<div class="row"><div class="col-8 mx-0"><b>' + issue["Issue"] + '</b><br><br><a href="' + issue["Link"] + '">' + issue["CWE"] + '</a></div><div class="col-4 mx-0 text-right"><b>Severity :</b> <span class="badge rounded-pill text-bg-' + colors[issue["Severity"]] + ' m-1">' + issue["Severity"] + '</span><br><b>Confidence :</b> <span class="badge rounded-pill text-bg-' + colors[issue["Confidence"]] + ' m-1">' + issue["Confidence"] + '</span></div>'

            str += ' <div class="accordion-item"><h2 class="accordion-header" id="panel' + panel + '"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelcol' + panel + '" aria-expanded="true" aria-controls="panelcol' + panel + '"> ' + headding + ' </button></h2><div id="panelcol' + panel + '" class="accordion-collapse collapse" aria-labelledby="panel' + panel + '"><div class="accordion-body bg-light"><p><b>File Location : </b>'+ issue['Location'] +'</p><pre class="mx-0">' + issue["Code"] + '</pre></div></div></div>';
        }


        document.getElementById("accordionPanelsStayOpenExample").innerHTML = str;

    };
    </script>
</body>

</html>